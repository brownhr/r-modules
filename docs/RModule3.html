<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>File Management and Mapping Spatial Data</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="aoa_r.svg" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R Modules</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="Syllabus.html">
    <span class="fa fa-file-text"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    R Modules
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="RModule1.html">R Module 1</a>
    </li>
    <li>
      <a href="RModule2.html">R Module 2</a>
    </li>
    <li>
      <a href="RModule3.html">R Module 3</a>
    </li>
    <li>
      <a href="RModule5.html">R Module 5</a>
    </li>
    <li>
      <a href="RModule6.html">R Module 6</a>
    </li>
    <li>
      <a href="RModule7.html">R Module 7</a>
    </li>
    <li>
      <a href="RModule8.html">R Module 8</a>
    </li>
    <li>
      <a href="RModule9.html">R Module 9</a>
    </li>
    <li>
      <a href="RModule10.html">R Module 10</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">File Management and Mapping Spatial
Data</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="file-management" class="section level1">
<h1>File Management</h1>
<p>When we work with real-life data, it’s important to know how to both
read data from our computer and write data from R Studio as a file. File
management is an essential part of any workflow, especially as the scope
and scale of analyses increases. Sometimes each file can be quite large
– often several dozen or hundred megabytes or more – so it’s important
to analyze data in a modular fashion (our computers have limited memory,
disk space, processing power, and speed, after all). Fortunately, many
tools exists within R and R Studio to make these tasks easier. In this R
Module, you’ll learn some skills and R Packages that are frequently used
to import and export data from your R environment.</p>
<p>Let’s go ahead and initialize a new R Project
(<code>File &gt; New Project...</code>) and call it <em>R Module
3</em>.</p>
<hr />
<div id="importing-and-exporting-data" class="section level2">
<h2>Importing and Exporting Data</h2>
<p>Working in future R Modules, classes, and projects, you’ll need to be
able to load, save, and share data. Fortunately, there are tools to load
this data for almost any data type, from .CSVs to Shapefiles, raster
images, and many more. We’ll go over a couple of the most useful tools
and packages used in data management to work with files in R.</p>
<p>In this lab, you’ll use a folder called <code>data</code>, which
contains a file called <code>mtcars.csv</code>. When working within R,
it’s important to know how to access files and folders. When you create
a project, the folder you set it up within is designated as your
<strong>working directory</strong>, which is a way of easily accessing
files for your project without writing the file’s full path. For
example, instead of accessing the file with
<code>C:/Users/brownhr/Documents/R Module 3/data/example.file</code>, if
you’re in the working directory “R Module 3” (which can be checked with
<code>getwd()</code>), you can simply type
<code>data/example.file</code>.</p>
<p><strong>N.B.</strong> within R, it is very important to distinguish
between <code>/</code> and <code>\</code>; <code>\</code> is called an
“escape character” and is used in more advanced text entry such as
Regex. If you want to enter a file path, use either
<code>C:/Example/File/path</code> or
<code>C:\\Example\\File\\path</code>; adding two backslashes is
necessary in this case.</p>
</div>
<div id="readr" class="section level2">
<h2><strong><code>readr</code></strong></h2>
<p>The <code>readr</code> package provides some excellent functionality
reading and writing data from and to files; while many of its functions
exist in base R, <code>readr</code> is markedly faster, and provides
more functionality for importing different types of data in a “tidy”
manner (“tidy” is a programming concept in R that we’ll get to later).
For more information about <code>readr</code>, visit <a
href="https://readr.tidyverse.org"
class="uri">https://readr.tidyverse.org</a></p>
<p><code>readr</code> comes with functions that allow for easy
manipulation of primarily table-based data, such as <code>.csv</code>
and <code>.tsv</code> files, allowing us to work with data that we make
in Excel or Google Sheets. Especially when working with large files, or
large numbers of files, <code>readr</code> makes importing and exporting
data easy, and is much faster at reading and writing than the base
<code>R</code> functions.</p>
<hr />
</div>
</div>
<div id="mapping-with-sf" class="section level1">
<h1>Mapping with <code>sf</code></h1>
<p>Simple Features for R, or <code>sf</code>, is an R package that
allows for much easier geospatial analysis than older packages like
<code>rgdal</code>. <code>sf</code> works with “simple features” –
vector objects in GIS like points, lines, polygons, etc. – and stores
their “geometry” – their list of coordinates – as a column in a data
frame. This allows for geospatial data to be processed in exactly the
same way as non-spatial data; you can run functions and analyses on the
attribute table of a shapefile without needing to convert or export to
any intermediate formats, for example.</p>
<p><code>sf</code> can work with Shapefiles and other vector formats
made by ArcGIS Pro, QGIS, etc., so if you have a shapefile, you can
import it into R with <code>read_sf()</code>, perform your analysis, and
export any sort of spatial result with <code>write_sf()</code>.</p>
<p>Even better, there’s compatibility with <code>ggplot2</code>! Suppose
we have two Shapefiles that we wish to map: <code>NC_Counties</code> and
<code>US_States</code>. Combining them is easy in
<code>ggplot2</code>:</p>
<pre class="r"><code># Load sf and the tidyverse, which contains packages like ggplot2 and dplyr

library(tidyverse)
library(sf)


# Read in the shapefiles with sf

US_States &lt;- read_sf(&quot;data/US_States.shp&quot;)
NC_Counties &lt;- read_sf(&quot;data/NC_Counties.shp&quot;)


# We can create a &#39;blank&#39; ggplot object and define the data and mappings
# separately, which is useful if we have more than one input file or want to
# display more than one dataset.

ggplot() +
  geom_sf(data = US_States, fill = &quot;white&quot;) +
  geom_sf(data = NC_Counties, aes(fill = Population), color = NA) +
  coord_sf(xlim = c(-86, -74), ylim = c(32, 38)) +
  theme_bw() +
  labs(title = &quot;Population per County for North Carolina&quot;)</code></pre>
<p><img src="RModule3_files/figure-html/sf-example-1.png" width="100%" /></p>
<p>Looks good so far! You’ll make a few maps of your own later in the
Module, so feel free to read more about how <code>geom_sf()</code> and
the other <code>ggplot2</code> and <code>sf</code> functions work.</p>
<p>Read more about <code>sf</code> by going to <a
href="https://r-spatial.github.io/sf/"
class="uri">https://r-spatial.github.io/sf/</a></p>
<p><strong>Create a new R Project, “R Module 3”, to include your code,
scripts, etc. Answer the following questions, and include them in your
final document:</strong></p>
<ol style="list-style-type: decimal">
<li><p>Within your <code>data/</code> folder, open the file
<code>NC_Counties.prj</code> with a program like Notepad or
Notepad++.</p>
<ul>
<li>What kind of information does this file contain?</li>
<li>Why is it important to include these “auxiliary” files?</li>
<li>What would happen if you forgot to include the <code>.prj</code>
file?</li>
</ul></li>
<li><p>For the <code>US_States</code> layer, the <code>fill</code>
argument stands on its own, while for <code>NC_Counties</code>, it’s
inside the <code>aes()</code> function. Why is this the case – what’s
the difference between these two layers?</p></li>
<li><p>What’s the purpose of the <code>coord_sf()</code> function? Use
<code>?coord_sf()</code> to view documentation and usage, and describe
its arguments.</p></li>
</ol>
<hr />
<div id="choropleth-mapping" class="section level2">
<h2>Choropleth Mapping</h2>
<p>Choropleth maps are a type of thematic map that is used to display
distinct geographic regions, such as states, counties, or countries. The
colors used in choropleth mapping are <strong>classified</strong>;
rather than a continuous range, the values are grouped into different
classes, so that similar values share a color.</p>
<p>The <code>tmap</code> package is very useful for choropleth mapping,
and offers a lot of functionality for customizing maps.</p>
<pre class="r"><code>library(tidyverse)
library(sf)
library(tmap)

# This function reprojects our shapefile into a different coordinate reference
# system (CRS), and is useful when performing GIS-related tasks. In this case,
# it&#39;s just to make the map look a little nicer.
data &lt;- US_States %&gt;%
  st_transform(crs = st_crs(&quot;ESRI:102004&quot;))

tm_shape(data) +
  tm_polygons(
    # We&#39;re setting the color (col) mapping to the column &quot;Population&quot;. Notice
    # that you have to quote the variable name here, which is different than in
    # ggplot2.
    col = &quot;Population&quot;,
    
    # You can use RColorBrewer::brewer.pal.info to view many different kinds of
    # color palettes available in R.
    palette = &quot;Blues&quot;,
    
    # This argument is used to normalize; i.e. convert from population to
    # population density. It&#39;s better to do this as a separate step in your
    # data, but can be done here for quick mapping purposes.
    convert2density = TRUE,
    
    # This sets the number of classes in our data.
    n = 6,
    
    # What method to use to create the classes. Note that some options might
    # overwrite your choice of n, so pay attention to how many classes your map
    # actually has!
    style = &quot;quantile&quot;,
  ) +
  tm_layout(
    title = &quot;Population per Sq. km.&quot;, title.position = c(&quot;center&quot;, &quot;top&quot;),
    legend.title.color = NA
  )</code></pre>
<p><img src="RModule3_files/figure-html/choropleth-1.png" width="672" /></p>
</div>
<div id="section" class="section level2">
<h2><!--
------------------------------------------------------------------------

## Mapping Techniques

--></h2>
<hr />
</div>
</div>
<div id="probability-and-distributions" class="section level1">
<h1>Probability and Distributions</h1>
<hr />
<div id="discrete-distributions" class="section level2">
<h2>Discrete Distributions</h2>
<p>Discrete probability distributions count occurrences that have
countable or finite outcomes, such as the population of states within
the U.S., days of rainfall, or average number of pets in households.</p>
<div id="uniform" class="section level3">
<h3>Uniform</h3>
<p><img src="RModule3_files/figure-html/unif-1.png" width="672" /></p>
</div>
<div id="binomial" class="section level3">
<h3>Binomial</h3>
<p><img src="RModule3_files/figure-html/binom-1.png" width="672" /></p>
</div>
<div id="poisson-distribution" class="section level3">
<h3>Poisson Distribution</h3>
<p>A Poisson distribution refers to a kind of discrete distribution that
shows the probability of a given number of events <span
class="math inline">\(k\)</span> occurring, given the parameter lambda,
<span class="math inline">\(\lambda\)</span>. <span
class="math inline">\(\lambda\)</span> can be thought of as the “average
number of events”; for example, if the average number of goals in a
World Cup match is 2.5, then <span class="math inline">\(\lambda =
2.5\)</span>. Mathematically, the Poisson distribution is modeled by:
<span class="math display">\[p(k; \lambda) =
\frac{e^{-\lambda}\lambda^{k}}{{k}!},\]</span> where <span
class="math inline">\(k\)</span> is the given number of events that we
want to calculate the probability for. For example, if we want to find
the probability of 5 goals being scored in a World Cup game, we can
calculate the following in R:</p>
<pre class="r"><code>p &lt;- dpois(x = 5, lambda = 2.5)

print(p)</code></pre>
<pre><code>## [1] 0.06680094</code></pre>
<p>So, <span class="math inline">\(\approx6.68\%\)</span> of the time, 5
goals will be scored. The functions <code>dpois()</code>,
<code>ppois()</code>, <code>qpois()</code>, and <code>rpois()</code> are
used to calculate the Poisson distribution.</p>
<p><img src="RModule3_files/figure-html/setup-poisson,%20message%20F-1.png" width="672" /></p>
<p>Poisson Distribution with <span
class="math inline">\(\lambda\)</span> = 2.5</p>
<hr />
</div>
</div>
<div id="continuous-distributions" class="section level2">
<h2>Continuous Distributions</h2>
<p>Continuous distributions differ from discrete distributions in that
outcomes can lie on a continuous range of values, for example, average
daily temperature, atmospheric pressure, or height of buildings.</p>
<p><img src="RModule3_files/figure-html/continuous-1.png" width="672" /></p>
<hr />
<hr />
</div>
</div>
<div id="assignment" class="section level1">
<h1>Assignment</h1>
<p><strong>In addition to questions 1-3 above, answer the following.
Write up your responses, and submit your document to Google
Classroom:</strong></p>
<ol start="4" style="list-style-type: decimal">
<li><p>Using <code>ggplot2</code>, generate a histogram of the
distribution of county population. Include axis labels, a title, and
your name.</p></li>
<li><p>What type (continuous or discrete) does this distribution follow?
Is the data normally distributed? If not, what kind of transformation
can help “normalize” our data?</p></li>
<li><p>With a shapefile of your own (using ArcGIS, the
<code>tigris</code> or <code>tidycensus</code> packages, or other),
create a choropleth map using 5 classes, including a title and a legend.
Create a map for both <em>quantile</em> and <em>equal-interval</em>
classification, and briefly describe the difference in distribution
between your two maps.</p></li>
<li><p>Repeat Question 6, using a different choice of classes.</p></li>
</ol>
</div>

<p>&copy; 2022 Maggie Sugg & Harrison Brown. v.0.0.15</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
