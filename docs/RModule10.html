<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Spatial Regression</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="logo.svg" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R Modules</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="Syllabus.html">
    <span class="fa fa-file-text"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    R Modules
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="RModule1.html">R Module 1</a>
    </li>
    <li>
      <a href="RModule2.html">R Module 2</a>
    </li>
    <li>
      <a href="RModule3.html">R Module 3</a>
    </li>
    <li>
      <a href="RModule5.html">R Module 5</a>
    </li>
    <li>
      <a href="RModule6.html">R Module 6</a>
    </li>
    <li>
      <a href="RModule7.html">R Module 7</a>
    </li>
    <li>
      <a href="RModule8.html">R Module 8</a>
    </li>
    <li>
      <a href="RModule9.html">R Module 9</a>
    </li>
    <li>
      <a href="RModule10.html">R Module 10</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Spatial Regression</h1>

</div>


<hr />
<div id="spatial-regression-in-r" class="section level1">
<h1>Spatial Regression in R</h1>
<p>Regression residuals are the primary way to assess if a regression
violates any assumptions of the general linear model. Although all the
assumptions are important, the violation of the assumption of
independence is common with spatially organized data. This has led to
the development of a family of alternate regression models that can
accommodate spatial dependence. We’ll work with two of theme models
continuing from the previous two R Modules. These are known as the
<em>spatial lag model</em> and <em>spatial error model</em>. Both models
account for spatial dependence by including new parameters that must be
estimated; each model, however, handles this in a different way…</p>
<div id="spatial-lag-model" class="section level2">
<h2>Spatial Lag Model</h2>
<p>The spatial lag model, shown below, introduces a new explanatory
variable and an associated coefficient that must be estimated:</p>
<p><span class="math display">\[ y = \rho W_y + \beta X +
\varepsilon\]</span></p>
<p>The new variable, <span class="math inline">\(W_y\)</span>, is the
“lag variable” and represents, for each spatial unit, the weighted
average of the values of the observations among its neighbors (when
working with a row-standardized matrix).</p>
<p>The term <span class="math inline">\(\beta X\)</span> represents our
independent variables, and epsilon (<span
class="math inline">\(\varepsilon\)</span>) is our “error term”, which
describes the amount by which an observed value differs from the
expected value, based on the whole population.</p>
<p>Just like in “normal” regression models, there exists a correlation
coefficient, in this case rho (<span
class="math inline">\(\rho\)</span>), and for spatial regression the
value of <span class="math inline">\(\rho\)</span> must be estimated.
<span class="math inline">\(\rho\)</span> is one of the key statistics;
our null hypothesis is that <span class="math inline">\(\rho =
0\)</span>, which represents zero spatial dependence in the <span
class="math inline">\(W_y\)</span> dependent variable.</p>
<p>A statistically significant result, therefore is when <span
class="math inline">\(\rho \neq 0\)</span>, meaning we have successfully
adjusted our model to account for any spatial dependence.</p>
<p>As with Moran’s I, <span class="math inline">\(\rho\)</span> can be
either positive, indicating positive spatial dependence, or negative,
indicating negative spatial dependence.</p>
</div>
<div id="spatial-error-model" class="section level2">
<h2>Spatial Error Model</h2>
<p>The other model we have is known as the <em>spatial error model</em>.
Unlike the lag model, the error model addresses spatial dependence by
separating the error term <span
class="math inline">\(\varepsilon\)</span> into two components: one that
contains the “random error” (<span class="math inline">\(\xi\)</span>),
and one that contains the spatially-autocorrelated error components
(<span class="math inline">\(\lambda W_\varepsilon\)</span>):</p>
<p><span class="math display">\[y = \beta X + \varepsilon; \;\varepsilon
= \lambda W \varepsilon + \xi\]</span></p>
<p>As with the spatial lag model, the spatial error model has a
coefficient, lambda (<span class="math inline">\(\lambda\)</span>),
which must be estimated. The remaining errors, xi (<span
class="math inline">\(\xi\)</span>), should be randomly distributed as
per the conventional general linear model. The interpretations of <span
class="math inline">\(\lambda\)</span> are similar to that of <span
class="math inline">\(\rho\)</span> in the lag model, as is the
hypothesis test informed by the coefficient’s value and <span
class="math inline">\(p\)</span>-value (i.e., our null hypothesis is
that <span class="math inline">\(\lambda = 0\)</span>)</p>
</div>
</div>
<div id="importance-of-spatial-autocorrelation" class="section level1">
<h1>Importance of Spatial Autocorrelation</h1>
<p>Both of these models are computationally intensive and require the
extra steps of defining a neighborhood construct and its associated
weighted matrix, so why bother with calculating this?</p>
<p>The problem of spatially autocorrelated residuals means that we
<strong>really</strong> can’t trust our results. Think about it like
this: if values that are spatially close to one another have similar
values, if we don’t account for spatial autocorrelation, our variables
appear to have strong correlation. Not only that, without accounting for
spatial autocorrelation, our <span
class="math inline">\(p\)</span>-values are much lower, so it also looks
like our model is much more statistically significant. This is a long
way to say that any inferences we make based on such models, without
accounting for spatial autocorrelation, could be very inaccurate.</p>
<hr />
</div>
<div id="bringing-in-the-data" class="section level1">
<h1>Bringing in the Data</h1>
<p>This week, we’ll perform our spatial models on a new set of data: a
Shapefile containing the results from the 2004 presidential election,
and is available to download from the Google Drive, or from here:</p>
<ul>
<li><a
href="http://www.personal.psu.edu/users/a/c/acr181/2004_Election.zip"
class="uri">http://www.personal.psu.edu/users/a/c/acr181/2004_Election.zip</a></li>
</ul>
<p>Unzip this folder and load the results into R with <code>sf</code>.
In addition, we’ll need to transform (reproject) our data into a
<em>crs</em> which uses linear units; we’ll use the US National Atlas
Equal Area, <code>EPSG:2163</code>. Refer to R Modules 8 and 9 on how to
transform your data with <code>sf</code>.</p>
<p>By the way, if you want to look up more coordinate reference systems,
check out <a href="https://epsg.io" class="uri">https://epsg.io</a></p>
<p>For our data, we want to model the dependent variable as a function
of our independent variable(s). Our DV is the percent of voters who
voted for Bush, and our IV is per capita income.</p>
<pre class="r"><code>library(tmap)

tm_shape(election) +
  tm_polygons(
    col = &quot;Bush_pct&quot;,
    border.col = NULL,
    style = &quot;quantile&quot;,
    n = 7
  )</code></pre>
<p><img src="RModule10_files/figure-html/bush-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>tm_shape(election) +
  tm_polygons(
    col = &quot;pcincome&quot;,
    border.col = NULL,
    style = &quot;quantile&quot;,
    n = 7
  )</code></pre>
<p><img src="RModule10_files/figure-html/income-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Take a look at the dataset with tools like <code>View()</code> to
familiarize yourself with the data and the variables.</p>
<div id="spatial-weights" class="section level2">
<h2>Spatial Weights</h2>
<p>Let’s make a spatial weights matrix, just as in previous Modules:</p>
<pre class="r"><code>library(spdep)

us_neighbors &lt;- election %&gt;%
  poly2nb(queen = TRUE)

us_centroids &lt;- st_centroid(election)$geometry

us_neighbors_w &lt;- us_neighbors %&gt;%
  nb2listw(
    style = &quot;W&quot;,
    zero.policy = TRUE
  )</code></pre>
<p>We can plot the connections to see if they look good:</p>
<!-- Not actually plotting it in-document; it just takes a long time :) -->
<pre class="r"><code>us_neighbors %&gt;%
  nb2lines(
    coords = us_centroids
  ) %&gt;%
  qtm()</code></pre>
<p><img src="img/R%20Module%2010/neighbors.png" width="60%" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="testing-autocorrelation" class="section level2">
<h2>Testing Autocorrelation</h2>
<p>We can run a global Moran’s I or Geary’s C test on both variables
that we’ll use in the regression models. First, let’s test for spatial
autocorrelation among the dependent variable, <code>Bush_pct</code>:</p>
<pre class="r"><code>moran.test(
  x = election$Bush_pct,
  listw = us_neighbors_w,
  zero.policy = TRUE
)

geary.test(
  x = election$Bush_pct,
  listw = us_neighbors_w,
  zero.policy = TRUE
)</code></pre>
<p>Then, perform the tests on the independent variable,
<code>pcincome</code>:</p>
<pre class="r"><code>moran.test(
  x = election$pcincome,
  listw = us_neighbors_w,
  zero.policy = TRUE
)

geary.test(
  x = election$pcincome,
  listw = us_neighbors_w,
  zero.policy = TRUE
)</code></pre>
<p>What do the results show? Both variables are strongly and positively
spatially autocorrelated, when using the Queen’s case <span
class="math inline">\(W_{ij}\)</span>. This is a clue that we should see
spatially autocorrelation among the residuals from a basic linear
regression. If so, we’ll need to use a spatial regression model (hint,
we will!) to estimate the “true nature” of the relationship.</p>
</div>
<div id="questions" class="section level2">
<h2>Questions</h2>
<p><strong>1. Use <code>lm()</code> to estimate
<code>Bush_pct ~ pcincome</code> using ordinary least squares (OLS).
Plot the <em>residuals</em> on a map (look back to R Module 7) and
<em>test the residuals for spatial autocorrelation</em>. Provide both an
example of your map and the results from your spatial autocorrelation
test in your R Markdown report.</strong> - Hint: Your results should
look somewhat similar to the results below:</p>
<p><img src="RModule10_files/figure-html/resids-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="performing-spatial-lag" class="section level1">
<h1>Performing Spatial Lag</h1>
<p>From our map, it definitely looks like there’s spatial
autocorrelation among our residuals. After testing the residuals using
Moran’s I or Geary’s C, we’ve successfully confirmed that our residuals
are spatially autocorrelated; what does this mean, exactly? For
starters, it strongly affects the apparent relationship between
<code>Bush_pct</code> and <code>pcincome</code>. Our linear model
suggests that there is a significant relationship between the two
variables, but after seeing how strongly the residuals are spatially
autocorrelated, it’s difficult to say if this relationship is actually
this strong, or if it’s due to spatial proximity.</p>
<p>Let’s perform our first spatial regression using the spatial lag
model. Our function <code>lagsarlm</code> from the
<code>spatialreg</code> package works very similarly to the traditional
<code>lm</code> function, with a few additional arguments to input our
spatial weights matrix. Let’s give it a shot:</p>
<pre class="r"><code>library(spatialreg)

# This function takes a good bit of time to run; maybe ~5 mins depending on the
# machine you&#39;re running this on.

bush_lag &lt;- lagsarlm(Bush_pct ~ pcincome,
  data = election,
  listw = us_neighbors_w,
  zero.policy = TRUE,
  quiet = FALSE
)

# The `broom` package has many functions for &quot;tidy-ing&quot; data, and includes a
# Method for tidying the results from the lagsarlm function. You can also use
# this function on the results from ANOVA, lm, moran.test, etc!

broom::tidy(bush_lag)</code></pre>
<pre><code>## # A tibble: 3 x 5
##   term          estimate std.error statistic p.value
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 rho          0.751     0.0143        52.5    0    
## 2 (Intercept) 14.1       1.06          13.3    0    
## 3 pcincome     0.0000546 0.0000338      1.62   0.106</code></pre>
<p>The values we’re interested are our <span
class="math inline">\(\rho\)</span> statistic, <code>Rho</code>, and our
<span class="math inline">\(p\)</span>-value. Looking at this result, we
can confidently say that the value of <code>Bush_pct</code> is likely to
have higher values, if neighboring counties have higher values, and
lower values if the neighboring counties have lower values. Notice,
also, that our independent variable <code>pcincome</code> now has a
<span class="math inline">\(p\)</span>-value of 0.1058; <strong>it’s no
longer significant when accounting for spatial
autoccorelation!</strong></p>
<div id="checking-our-residuals" class="section level2">
<h2>Checking our Residuals</h2>
<p>After performing our spatial lag model, it’s important to check our
results to verify if we’ve truly accounted for spatial autocorrelation.
All we need to do, then, is run a Moran’s I test on the
<em>residuals</em> of the spatial lag model, and if the value of <span
class="math inline">\(I\)</span> is close to 0, then there’s no spatial
autocorrelation among our residuals, which means our spatial lag model
performed adequately.</p>
<pre class="r"><code>election$bush_lag_res &lt;- bush_lag$residuals

lag_moran &lt;- moran.test(
  x = election$bush_lag_res,
  listw = us_neighbors_w,
  zero.policy = TRUE,
  alternative = &quot;two.sided&quot;
)</code></pre>
<pre class="r"><code>tm_shape(election) +
  tm_polygons(
    col = &quot;bush_lag_res&quot;,
    border.col = NULL,
    palette = &quot;RdBu&quot;,
    style = &quot;cont&quot;,
    midpoint = 0,
    title = &quot;Residuals (Lag)&quot;
  )</code></pre>
<p><img src="RModule10_files/figure-html/lag-resids-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This looks pretty good; ideally, our value of <span
class="math inline">\(I\)</span> would be exactly 0, but this tells us
that any remaining spatial autocorrelation is very weak. Plotting the
residuals from our lag model (in exactly the same way we did from the
residuals from <code>lm()</code>), we can see that there’s no strong
spatial pattern that emerges, unlike our residuals from
<code>lm()</code>.</p>
</div>
<div id="questions-1" class="section level2">
<h2>Questions</h2>
<ol start="2" style="list-style-type: decimal">
<li>Modeling <code>Kerry_pct ~ pcincome</code>, perform the following
steps:</li>
</ol>
<ul>
<li>Evaluate the relationship between the variables using
<code>lm()</code></li>
<li>Plot the resulting residuals, then test for autocorrelation with
<code>moran.test()</code>. Provide your map!</li>
<li>Estimate the same relationship, using the spatial lag model
(<code>spatialreg::lagsarlm()</code>)</li>
<li>Perform a Moran’s I test on the residuals from the lag model and
report your results. Plot the residuals from the spatial lag model, and
include in your report.</li>
<li>Is there evidence of remaining spatial autocorrelation in the
residuals?</li>
</ul>
</div>
</div>
<div id="spatial-error-model-1" class="section level1">
<h1>Spatial Error Model</h1>
<p>Now that we’ve seen what the spatial lag model does, let’s try
running a spatial error model:</p>
<pre class="r"><code>bush_error &lt;- errorsarlm(
  formula = Bush_pct ~ pcincome,
  data = election,
  listw = us_neighbors_w,
  zero.policy = T,
  quiet = FALSE
)

summary(bush_error)</code></pre>
<pre><code>## 
## Call:
## errorsarlm(formula = Bush_pct ~ pcincome, data = election, listw = us_neighbors_w, 
##     quiet = FALSE, zero.policy = T)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -62.1908  -4.3998   1.2162   5.6286  33.8837 
## 
## Type: error 
## Regions with no neighbours included:
##  36 691 711 883 
## Coefficients: (asymptotic standard errors) 
##               Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept) 5.8347e+01 9.9104e-01 58.8747  &lt; 2e-16
## pcincome    8.0218e-05 4.1698e-05  1.9238  0.05438
## 
## Lambda: 0.76197, LR test value: 1803.8, p-value: &lt; 2.22e-16
## Asymptotic standard error: 0.014223
##     z-value: 53.574, p-value: &lt; 2.22e-16
## Wald statistic: 2870.2, p-value: &lt; 2.22e-16
## 
## Log likelihood: -11428.06 for error model
## ML residual variance (sigma squared): 78.896, (sigma: 8.8823)
## Number of observations: 3111 
## Number of parameters estimated: 4 
## AIC: 22864, (AIC for lm: 24666)</code></pre>
<p>And of course, we should map our results:</p>
<pre class="r"><code>election$bush_err_res &lt;- bush_error$residuals


tm_shape(election) +
  tm_polygons(
    col = &quot;bush_err_res&quot;,
    border.col = NULL,
    palette = &quot;RdBu&quot;,
    style = &quot;cont&quot;,
    midpoint = 0,
    title = &quot;Residuals&quot;
  )</code></pre>
<p><img src="RModule10_files/figure-html/errorsarlm-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finally, let’s test our residuals for any remaining spatial
autocorrelation:</p>
<pre class="r"><code>moran.test(
  x = election$bush_err_res,
  listw = us_neighbors_w,
  zero.policy = TRUE,
  alternative = &quot;two.sided&quot;
)</code></pre>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  election$bush_err_res  
## weights: us_neighbors_w  n reduced by no-neighbour observations
##   
## 
## Moran I statistic standard deviate = -4.7192, p-value = 2.367e-06
## alternative hypothesis: two.sided
## sample estimates:
## Moran I statistic       Expectation          Variance 
##     -0.0510920669     -0.0003219575      0.0001157378</code></pre>
<p>While it’s a little bit higher than the value from the spatial lag
model, it still shows that we’ve accounted for most of the spatial
autocorrelation. Think about some of the other factors that could have
been affecting our spatial regression models, for example, is the
neighborhood (Queen’s case) the best fit for our data?</p>
<div id="questions-2" class="section level2">
<h2>Questions</h2>
<ol start="3" style="list-style-type: decimal">
<li>Using your <code>Kerry_pct ~ pcincome</code> analysis, perform the
spatial error model. Provide the results of the model and plot its
residuals on a map. Then, perform Moran’s I on the resulting residuals,
and provide the Moran’s I and p-value. Explain any differences in the
values between:</li>
</ol>
<ul>
<li>The coefficient variables (<span
class="math inline">\(\lambda\)</span> and <span
class="math inline">\(\rho\)</span>),</li>
<li>The p-values in the spatial regression models,</li>
<li>The Moran’s I statistics, and,</li>
<li>The p-values from the Moran’s I</li>
</ul>
</div>
</div>

<p>&copy; 2022 Maggie Sugg & Harrison Brown. v.0.0.13</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
